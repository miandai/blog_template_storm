---
layout: post
keywords: blog
description: blog
title: "《Microsoft .NET企业级应用架构设计》读书笔记之数据访问层"
categories: [.net]
tags: [.net]
---
{% include codepiano/setup %}

从分层系统角度来看，系统中的表现层用来定义用户界面，业务层用来定义对象模型和系统的行为，而数据访问层泽用来操作数据库，运行查询并执行更新。

若使用非领域模型来设计业务逻辑，哪怕是活动记录，持久化都会内建在业务逻辑中，数据访问层实际上也和业务层混在了一起。这时的数据访问层实际上就是一系列存储过程和SQL语句的集合。

仅仅在用领域模型模式创建了完善的领域模型的情况下，你才需要一个专门定制的数据访问层。

实现数据库独立性的做法：1、当服务层获取到当前数据访问层的引用后，服务层以多态的形式，通过公开接口中的方法与该数据访问层通信。2、使用对象/关系映射工具(O/RM)。

数据访问层中实现查询服务的模式：1、查询对象模式，见《企业应用架构模式》 by Martin Fowler第316页。2、仓储模式。

乐观的并发处理：最后写入者获胜

<!--more-->

业务逻辑层4种主要的模式：

事务脚本：数据访问层需要实现的仅仅是纯粹的CRUD操作而已。主要的关注点在于用户的操作，而不是对业务实体或数据库表进行建模的对象。数据访问层负责在同一个事务范围内获取所有数据，并执行所有的数据操作。同样，在这种情况下区分业务层和数据访问层的意义也就仅在于设计方面。编码中，业务层和数据访问代码完全混在了一起。

表模块：数据访问层将仅仅包含表适配器，用来使用查询从DBMS中获取数据，并使用存储过程或SQL命令将数据写回数据库。数据访问层在逻辑上虞因为层混在了一起，甚至还在同一个程序集中。

活动记录：更加面向对象一些。数据访问层将根据活动记录对象模型中各个类的需要负责读取并写入数据。从模式角度考虑，这种情况与使用表模块模式非常类似，不过它使用对象模型而不是基于数据表的容器，它们的数据访问层在逻辑上都结合在业务层中，外界并不能直接使用。

领域模型：若倾向于领域驱动设计，并选择使用领域模型模式，那么数据访问层是服务层必不可少的一个工具，用来为领域模型类提供数据。数据访问层属于业务层的一个补充，一般由服务层使用。

数据访问层和领域模型并不直接通信，而是靠服务层来协调，这也是架构上的关键之处。

若能控制表现层调用数据访问层的做法，那么结果将非常不错，不过这样做也为两个不相关的层之间添加了不应有的紧密耦合，因此在需要时可以拿来应急，不过随后要尽早重构。




